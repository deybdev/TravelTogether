<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geolocation on Leaflet Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <style>
        .leaflet-popup-content {
            font-size: 18px;
            font-weight: bold;
        }
        .leaflet-popup-close-button {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Geolocation on Leaflet Map</h1>
    <h4 id="locationName">Casa Manila</h4>
    <p id="locationAddress">Plaza San Luis Complex, General Luna corner Real Streets, Intramuros, Manila.</p>
    <div id="map" style="height: 500px;"></div>

    <script>
        function initializeMap() {
            const locationName = document.getElementById('locationName').innerText;
            const locationAddress = document.getElementById('locationAddress').innerText;
            const apiKey = 'bf94dc68ddeb4233848df1c7e8b2b9c8';

            // Function to get coordinates from OpenCage API
            function getCoordinates(query) {
                return fetch(`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(query)}&key=${apiKey}`)
                    .then(response => response.json())
                    .then(data => data.results[0]?.geometry);
            }

            // Try address first, then fallback to location name
            getCoordinates(locationAddress)
                .then(coords => coords || getCoordinates(locationName))
                .then(coords => {
                    if (!coords) {
                        alert('Location not found.');
                        return;
                    }

                    const { lat, lng } = coords;
                    const map = L.map('map').setView([lat, lng], 18);

                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(map);

                    L.marker([lat, lng])
                        .addTo(map)
                        .bindPopup(`${locationName}`)
                        .openPopup();
                })
                .catch(() => alert('Error fetching location.'));
        }

        initializeMap();
    </script>
</body>
</html>
